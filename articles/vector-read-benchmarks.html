<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Vector Read Benchmarks • gdalraster</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Vector Read Benchmarks">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gdalraster</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/raster-api-tutorial.html">Raster API Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/raster-display.html">Raster Display</a></li>
    <li><a class="dropdown-item" href="../articles/raster-attribute-tables.html">Raster Attribute Tables</a></li>
    <li><a class="dropdown-item" href="../articles/gdal-block-cache.html">GDAL Block Cache</a></li>
    <li><a class="dropdown-item" href="../articles/vector-api-overview.html">Vector API Overview</a></li>
    <li><a class="dropdown-item" href="../articles/vector-read-benchmarks.html">Vector Read Benchmarks</a></li>
    <li><a class="dropdown-item" href="../articles/gdal-config-quick-ref.html">GDAL Config Quick Reference</a></li>
    <li><a class="dropdown-item" href="../articles/use-gdal-cli-from-r.html">Using 'gdal' CLI algorithms from R</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Archived articles</h6></li>
    <li><a class="dropdown-item" href="../articles/gdalvector-draft.html">Draft Bindings to the GDAL/OGR Vector API</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/firelab/gdalraster/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Vector Read Benchmarks</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/firelab/gdalraster/blob/main/vignettes/articles/vector-read-benchmarks.Rmd" class="external-link"><code>vignettes/articles/vector-read-benchmarks.Rmd</code></a></small>
      <div class="d-none name"><code>vector-read-benchmarks.Rmd</code></div>
    </div>

    
    
<p>Vector read benchmarks for R package
<strong>gdalraster</strong><br>
(last updated 2025-12-14)</p>
<p>The following benchmark tests follow the format of benchmarks
described in GDAL <a href="https://gdal.org/en/stable/development/rfc/rfc86_column_oriented_api.html#benchmarks" class="external-link">RFC
86: Column-oriented read API for vector layers</a> using the same
dataset. The timings here cannot be compared directly with the GDAL
timings due to hardware differences (hardware used for the GDAL
benchmarks is not specified). The benchmarks are intended as a sanity
check on read performance in the context of ranges seen for two
different I/O methods (traditional GetNextFeature() iteration
vs. column-oriented ArrowArrayStream), and multiple implementations in
both plain C++ and using Python libraries as described for the GDAL
benchmarks, and using R packages described here.</p>
<p>The C++ benchmark programs used in RFC 86 are also included here to
measure baseline raw performance under the same hardware and software
environment. Directly comparing the timings between the .cpp and .R
programs in their current forms should consider that the cpp programs
both read the 3.3 million features in the test dataset but do not
populate a data structure, while the R programs populate a data frame
object and return it.</p>
<div class="section level2">
<h2 id="hardware">Hardware<a class="anchor" aria-label="anchor" href="#hardware"></a>
</h2>
<p>Dell XPS 13 laptop 9350 (2024 edition), Intel® Core™ Ultra 7 258V x 8
cores up to 4.8 GHz Lunar Lake CPU, 32GB LPDDR5X RAM 8533MT/s
integrated, 1 TB SSD</p>
</div>
<div class="section level2">
<h2 id="software-environment">Software environment<a class="anchor" aria-label="anchor" href="#software-environment"></a>
</h2>
<p>Ubuntu Linux 24.04.3 LTS, R 4.5.2 (2025-10-31), GDAL 3.12.0 (released
2025-11-03) local build, <strong>gdalraster</strong> 2.3.0.9007,
<strong>sf</strong> 1.0.23</p>
</div>
<div class="section level2">
<h2 id="vector-data">Vector data<a class="anchor" aria-label="anchor" href="#vector-data"></a>
</h2>
<p>NZ Building Outlines, <a href="https://data.linz.govt.nz/layer/101290-nz-building-outlines/" class="external-link uri">https://data.linz.govt.nz/layer/101290-nz-building-outlines/</a>,
from Land Information New Zealand: “This dataset provides current
outlines of buildings within mainland New Zealand captured from the
latest aerial imagery.”</p>
<p>Tests used the GeoPackage file nz-building-outlines.gpkg (1.5 GB).
The layer contains 3.3 million features, each with 13 attribute fields
(2 fields of type Integer, 8 of type String, 3 of type DateTime) and
polygon geometries.</p>
</div>
<div class="section level2">
<h2 id="benchmark-programs">Benchmark programs<a class="anchor" aria-label="anchor" href="#benchmark-programs"></a>
</h2>
<p>Each program reads all features from the layer and populates an R
data frame. Code for the programs along with output generated by
<code>reprex::reprex()</code> is given in a separate section further
below.</p>
<p><strong>bench_ogr.cpp</strong></p>
<p>Benchmark C++ program used in RFC 86, re-run here for comparisons
within the same hardware/software environment. Use of traditional
<code>OGRLayer::GetNextFeature()</code> and related API from C. Reads
each feature but does not populate a data structure, representing
baseline raw performance.</p>
<p><strong>bench_gdalraster_fetch.R</strong></p>
<p>Uses the class method <code>GDALVector$fetch()</code> in
<strong>gdalraster</strong> for traditional row-level reading done in
C++ iterating over features with <code>OGRLayer::GetNextFeature()</code>
in the GDAL API. The method is an analog of function
<code>DBI::dbFetch()</code> in the <strong>DBI</strong> R package.</p>
<p><strong>bench_gdalraster_fetch_conv_to_sf.R</strong></p>
<p>The same as bench_gdalraster_fetch.R (traditional row-level access)
but with conversion to a classed <strong>sf</strong> data frame via
<code>sf::st_sf()</code> included in the timing.</p>
<p><strong>bench_sf_read_sf.R</strong></p>
<p>Traditional row-level read using package <strong>sf</strong> for its
function <code>sf::read_sf()</code>. Populates a classed data frame,
with geometries contained in a classed list column.</p>
<p><strong>bench_ogr_batch.cpp</strong></p>
<p>Benchmark C++ program used in RFC 86, re-run here for comparisons
within the same hardware/software environment. Use of the
<code>GetNextRecordBatch()</code> API from C++ with GDAL &gt;= 3.6.
Reads each feature but does not populate a data structure, representing
baseline raw performance with the Array Stream interface.</p>
<p><strong>bench_gdalraster_arrow_stream.R</strong> (requires GDAL &gt;=
3.6)</p>
<p>Uses the class method <code>GDALVector$getArrowStream()</code> in
<strong>gdalraster</strong> to expose an Arrow C stream on the layer as
a <code>nanoarrow_array_stream</code> object (external pointer to an
ArrowArrayStream). Provides direct access to the stream object and
retrieves features in a column-oriented memory layout. The required
package <strong>nanoarrow</strong> provides S3 methods for
<code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code> to import a <code>nanoarrow_array</code>
(one batch at a time), or the <code>nanoarrow_array_stream</code> itself
(pulling all batches in the stream).</p>
<p><strong>bench_sf_read_sf_use_stream.R</strong> (requires GDAL &gt;=
3.6)</p>
<p>Uses <code>sf::read_sf()</code> with argument
<code>use_stream = TRUE</code>: “use the experimental columnar interface
introduced in GDAL 3.6”.</p>
</div>
<div class="section level2">
<h2 id="timings">Timings<a class="anchor" aria-label="anchor" href="#timings"></a>
</h2>
<table class="table">
<caption>Read nz-building-outlines.gpkg (1.5 GB) and populate a data
frame.</caption>
<colgroup>
<col width="45%">
<col width="11%">
<col width="21%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th align="left">Bench program</th>
<th align="right">Time (s)</th>
<th align="left">Data frame class</th>
<th align="left">Geom list column</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">bench_ogr.cpp</td>
<td align="right">2.63</td>
<td align="left">none</td>
<td align="left">n/a</td>
</tr>
<tr class="even">
<td align="left">bench_gdalraster_fetch.R</td>
<td align="right">11.20</td>
<td align="left">OGRFeatureSet</td>
<td align="left">WKB <code>raw</code> vectors</td>
</tr>
<tr class="odd">
<td align="left">bench_gdalraster_fetch_conv_to_sf.R</td>
<td align="right">25.01</td>
<td align="left">sf</td>
<td align="left">classed sfc</td>
</tr>
<tr class="even">
<td align="left">bench_sf_read_sf.R</td>
<td align="right">77.24</td>
<td align="left">sf</td>
<td align="left">classed sfc</td>
</tr>
<tr class="odd">
<td align="left">bench_ogr_batch.cpp</td>
<td align="right">0.45</td>
<td align="left">none</td>
<td align="left">n/a</td>
</tr>
<tr class="even">
<td align="left">bench_gdalraster_arrow_stream.R</td>
<td align="right">2.87</td>
<td align="left">base data.frame</td>
<td align="left">WKB <code>raw</code> vectors</td>
</tr>
<tr class="odd">
<td align="left">bench_sf_read_sf_use_stream.R</td>
<td align="right">11.17</td>
<td align="left">sf</td>
<td align="left">classed sfc</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="code">Code<a class="anchor" aria-label="anchor" href="#code"></a>
</h2>
<div class="section level3">
<h3 id="bench_ogr-cpp-rfc86-benchmark">bench_ogr.cpp (<a href="https://gdal.org/en/stable/development/rfc/rfc86_column_oriented_api.html#benchmarks" class="external-link">RFC86
benchmark</a>)<a class="anchor" aria-label="anchor" href="#bench_ogr-cpp-rfc86-benchmark"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">// https://gdal.org/en/stable/development/rfc/rfc86_column_oriented_api.html#benchmarks</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="pp">#include </span><span class="im">"gdal_priv.h"</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="pp">#include </span><span class="im">"ogr_api.h"</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="pp">#include </span><span class="im">"ogrsf_frmts.h"</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[])</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    GDALAllRegister<span class="op">();</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    GDALDataset<span class="op">*</span> poDS <span class="op">=</span> GDALDataset<span class="op">::</span>Open<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>    OGRLayer<span class="op">*</span> poLayer <span class="op">=</span> poDS<span class="op">-&gt;</span>GetLayer<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>    OGRLayerH hLayer <span class="op">=</span> OGRLayer<span class="op">::</span>ToHandle<span class="op">(</span>poLayer<span class="op">);</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>    OGRFeatureDefnH hFDefn <span class="op">=</span> OGR_L_GetLayerDefn<span class="op">(</span>hLayer<span class="op">);</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>    <span class="dt">int</span> nFields <span class="op">=</span> OGR_FD_GetFieldCount<span class="op">(</span>hFDefn<span class="op">);</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a>    <span class="bu">std::</span>vector<span class="op">&lt;</span>OGRFieldType<span class="op">&gt;</span> aeTypes<span class="op">;</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span> <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> nFields<span class="op">;</span> i<span class="op">++</span> <span class="op">)</span></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>        aeTypes<span class="op">.</span>push_back<span class="op">(</span>OGR_Fld_GetType<span class="op">(</span>OGR_FD_GetFieldDefn<span class="op">(</span>hFDefn<span class="op">,</span> i<span class="op">)));</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a>    <span class="dt">int</span> nYear<span class="op">,</span> nMonth<span class="op">,</span> nDay<span class="op">,</span> nHour<span class="op">,</span> nMin<span class="op">,</span> nSecond<span class="op">,</span> nTZ<span class="op">;</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>    <span class="cf">while</span><span class="op">(</span> <span class="kw">true</span> <span class="op">)</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a>        OGRFeatureH hFeat <span class="op">=</span> OGR_L_GetNextFeature<span class="op">(</span>hLayer<span class="op">);</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span> hFeat <span class="op">==</span> <span class="kw">nullptr</span> <span class="op">)</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a>        OGR_F_GetFID<span class="op">(</span>hFeat<span class="op">);</span></span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span> <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> nFields<span class="op">;</span> i<span class="op">++</span> <span class="op">)</span></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a>            <span class="cf">if</span><span class="op">(</span> aeTypes<span class="op">[</span>i<span class="op">]</span> <span class="op">==</span> OFTInteger <span class="op">)</span></span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a>                OGR_F_GetFieldAsInteger<span class="op">(</span>hFeat<span class="op">,</span> i<span class="op">);</span></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a>            <span class="cf">else</span> <span class="cf">if</span><span class="op">(</span> aeTypes<span class="op">[</span>i<span class="op">]</span> <span class="op">==</span> OFTInteger64 <span class="op">)</span></span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a>                OGR_F_GetFieldAsInteger64<span class="op">(</span>hFeat<span class="op">,</span> i<span class="op">);</span></span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a>            <span class="cf">else</span> <span class="cf">if</span><span class="op">(</span> aeTypes<span class="op">[</span>i<span class="op">]</span> <span class="op">==</span> OFTReal <span class="op">)</span></span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a>                OGR_F_GetFieldAsDouble<span class="op">(</span>hFeat<span class="op">,</span> i<span class="op">);</span></span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a>            <span class="cf">else</span> <span class="cf">if</span><span class="op">(</span> aeTypes<span class="op">[</span>i<span class="op">]</span> <span class="op">==</span> OFTString <span class="op">)</span></span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a>                OGR_F_GetFieldAsString<span class="op">(</span>hFeat<span class="op">,</span> i<span class="op">);</span></span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a>            <span class="cf">else</span> <span class="cf">if</span><span class="op">(</span> aeTypes<span class="op">[</span>i<span class="op">]</span> <span class="op">==</span> OFTDateTime <span class="op">)</span></span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a>                OGR_F_GetFieldAsDateTime<span class="op">(</span>hFeat<span class="op">,</span> i<span class="op">,</span> <span class="op">&amp;</span>nYear<span class="op">,</span> <span class="op">&amp;</span>nMonth<span class="op">,</span> <span class="op">&amp;</span>nDay<span class="op">,</span> <span class="op">&amp;</span>nHour<span class="op">,</span> <span class="op">&amp;</span>nMin<span class="op">,</span> <span class="op">&amp;</span>nSecond<span class="op">,</span> <span class="op">&amp;</span>nTZ<span class="op">);</span></span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a>        OGRGeometryH hGeom <span class="op">=</span> OGR_F_GetGeometryRef<span class="op">(</span>hFeat<span class="op">);</span></span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span> hGeom <span class="op">)</span></span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a>            <span class="dt">int</span> size <span class="op">=</span> OGR_G_WkbSize<span class="op">(</span>hGeom<span class="op">);</span></span>
<span id="cb1-42"><a href="#cb1-42" tabindex="-1"></a>            GByte<span class="op">*</span> pabyWKB <span class="op">=</span> <span class="kw">static_cast</span><span class="op">&lt;</span>GByte<span class="op">*&gt;(</span>malloc<span class="op">(</span>size<span class="op">));</span></span>
<span id="cb1-43"><a href="#cb1-43" tabindex="-1"></a>            OGR_G_ExportToIsoWkb<span class="op">(</span> hGeom<span class="op">,</span> wkbNDR<span class="op">,</span> pabyWKB<span class="op">);</span></span>
<span id="cb1-44"><a href="#cb1-44" tabindex="-1"></a>            CPLFree<span class="op">(</span>pabyWKB<span class="op">);</span></span>
<span id="cb1-45"><a href="#cb1-45" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-46"><a href="#cb1-46" tabindex="-1"></a>        OGR_F_Destroy<span class="op">(</span>hFeat<span class="op">);</span></span>
<span id="cb1-47"><a href="#cb1-47" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-48"><a href="#cb1-48" tabindex="-1"></a>    <span class="kw">delete</span> poDS<span class="op">;</span></span>
<span id="cb1-49"><a href="#cb1-49" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-50"><a href="#cb1-50" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="ex">$</span> g++ bench_ogr.cpp <span class="at">-o</span> bench_ogr <span class="at">-O3</span> <span class="kw">`</span><span class="ex">pkg-config</span> <span class="at">--cflags</span> <span class="at">--libs</span> gdal<span class="kw">`</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="ex">$</span> time ./bench_ogr <span class="st">'/home/ctoney/data/gis/nz-building-outlines/nz-building-outlines.gpkg'</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="ex">real</span>  0m2.631s</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="ex">user</span>  0m2.458s</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="ex">sys</span>   0m0.172s</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bench_gdalraster_fetch-r">bench_gdalraster_fetch.R<a class="anchor" aria-label="anchor" href="#bench_gdalraster_fetch-r"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://firelab.github.io/gdalraster/">gdalraster</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; GDAL 3.10.3 (released 2025-04-01), GEOS 3.12.2, PROJ 9.4.1</span></span>
<span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="st">'/home/ctoney/data/gis/nz-building-outlines/nz-building-outlines.gpkg'</span></span>
<span><span class="op">(</span><span class="va">lyr</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALVector</span>, <span class="va">f</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; C++ object of class GDALVector</span></span>
<span><span class="co">#&gt;  Driver : GeoPackage (GPKG)</span></span>
<span><span class="co">#&gt;  DSN    : /home/ctoney/data/gis/nz-building-outlines/nz-building-outlines.gpkg</span></span>
<span><span class="co">#&gt;  Layer  : nz_building_outlines</span></span>
<span><span class="co">#&gt;  CRS    : NZGD2000 / New Zealand Transverse Mercator 2000 (EPSG:2193)</span></span>
<span><span class="co">#&gt;  Geom   : MULTIPOLYGON</span></span>
<span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3289574</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">fetch</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;  10.383   0.702  11.200</span></span>
<span></span>
<span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">==</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt; OGR feature set</span></span>
<span><span class="co">#&gt;   FID building_id name     use suburb_locality town_city territorial_authority</span></span>
<span><span class="co">#&gt; 1   1     2292051      Unknown          Marton    Marton   Rangitikei District</span></span>
<span><span class="co">#&gt; 2   2     2292353      Unknown      Durie Hill Whanganui    Whanganui District</span></span>
<span><span class="co">#&gt; 3   3     2292407      Unknown      Durie Hill Whanganui    Whanganui District</span></span>
<span><span class="co">#&gt; 4   4     2292675      Unknown        Feilding  Feilding     Manawatu District</span></span>
<span><span class="co">#&gt; 5   5     2292771      Unknown        Feilding  Feilding     Manawatu District</span></span>
<span><span class="co">#&gt; 6   6     2292825      Unknown        Feilding  Feilding     Manawatu District</span></span>
<span><span class="co">#&gt;       capture_method capture_source_group capture_source_id</span></span>
<span><span class="co">#&gt; 1 Feature Extraction    NZ Aerial Imagery              1042</span></span>
<span><span class="co">#&gt; 2 Feature Extraction    NZ Aerial Imagery              1042</span></span>
<span><span class="co">#&gt; 3 Feature Extraction    NZ Aerial Imagery              1042</span></span>
<span><span class="co">#&gt; 4 Feature Extraction    NZ Aerial Imagery              1042</span></span>
<span><span class="co">#&gt; 5 Feature Extraction    NZ Aerial Imagery              1042</span></span>
<span><span class="co">#&gt; 6 Feature Extraction    NZ Aerial Imagery              1042</span></span>
<span><span class="co">#&gt;                                       capture_source_name capture_source_from</span></span>
<span><span class="co">#&gt; 1 Manawatu Whanganui 0.3m Rural Aerial Photos (2015-2016)          2015-12-27</span></span>
<span><span class="co">#&gt; 2 Manawatu Whanganui 0.3m Rural Aerial Photos (2015-2016)          2015-12-27</span></span>
<span><span class="co">#&gt; 3 Manawatu Whanganui 0.3m Rural Aerial Photos (2015-2016)          2015-12-27</span></span>
<span><span class="co">#&gt; 4 Manawatu Whanganui 0.3m Rural Aerial Photos (2015-2016)          2015-12-27</span></span>
<span><span class="co">#&gt; 5 Manawatu Whanganui 0.3m Rural Aerial Photos (2015-2016)          2015-12-27</span></span>
<span><span class="co">#&gt; 6 Manawatu Whanganui 0.3m Rural Aerial Photos (2015-2016)          2015-12-27</span></span>
<span><span class="co">#&gt;   capture_source_to last_modified                                  geom</span></span>
<span><span class="co">#&gt; 1        2016-04-21    2019-01-04 WKB MULTIPOLYGON: raw 01 06 00 00 ...</span></span>
<span><span class="co">#&gt; 2        2016-04-21    2019-01-04 WKB MULTIPOLYGON: raw 01 06 00 00 ...</span></span>
<span><span class="co">#&gt; 3        2016-04-21    2019-01-04 WKB MULTIPOLYGON: raw 01 06 00 00 ...</span></span>
<span><span class="co">#&gt; 4        2016-04-21    2019-01-04 WKB MULTIPOLYGON: raw 01 06 00 00 ...</span></span>
<span><span class="co">#&gt; 5        2016-04-21    2019-01-04 WKB MULTIPOLYGON: raw 01 06 00 00 ...</span></span>
<span><span class="co">#&gt; 6        2016-04-21    2019-01-04 WKB MULTIPOLYGON: raw 01 06 00 00 ...</span></span>
<span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><sup>Created on 2025-12-13 with <a href="https://reprex.tidyverse.org" class="external-link">reprex v2.1.1</a></sup></p>
</div>
<div class="section level3">
<h3 id="bench_gdalraster_fetch_conv_to_sf-r">bench_gdalraster_fetch_conv_to_sf.R<a class="anchor" aria-label="anchor" href="#bench_gdalraster_fetch_conv_to_sf-r"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://firelab.github.io/gdalraster/">gdalraster</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; GDAL 3.10.3 (released 2025-04-01), GEOS 3.12.2, PROJ 9.4.1</span></span>
<span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="st">'/home/ctoney/data/gis/nz-building-outlines/nz-building-outlines.gpkg'</span></span>
<span><span class="op">(</span><span class="va">lyr</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALVector</span>, <span class="va">f</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; C++ object of class GDALVector</span></span>
<span><span class="co">#&gt;  Driver : GeoPackage (GPKG)</span></span>
<span><span class="co">#&gt;  DSN    : /home/ctoney/data/gis/nz-building-outlines/nz-building-outlines.gpkg</span></span>
<span><span class="co">#&gt;  Layer  : nz_building_outlines</span></span>
<span><span class="co">#&gt;  CRS    : NZGD2000 / New Zealand Transverse Mercator 2000 (EPSG:2193)</span></span>
<span><span class="co">#&gt;  Geom   : MULTIPOLYGON</span></span>
<span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3289574</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">d</span> <span class="op">&lt;-</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">fetch</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu">st_sf</span><span class="op">(</span><span class="va">d</span>, crs <span class="op">=</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">getSpatialRef</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;  23.533   1.395  25.010</span></span>
<span></span>
<span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">==</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 14 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 1776318 ymin: 5544066 xmax: 1818438 ymax: 5576891</span></span>
<span><span class="co">#&gt; Projected CRS: NZGD2000 / New Zealand Transverse Mercator 2000</span></span>
<span><span class="co">#&gt;   FID building_id name     use suburb_locality town_city territorial_authority</span></span>
<span><span class="co">#&gt; 1   1     2292051      Unknown          Marton    Marton   Rangitikei District</span></span>
<span><span class="co">#&gt; 2   2     2292353      Unknown      Durie Hill Whanganui    Whanganui District</span></span>
<span><span class="co">#&gt; 3   3     2292407      Unknown      Durie Hill Whanganui    Whanganui District</span></span>
<span><span class="co">#&gt; 4   4     2292675      Unknown        Feilding  Feilding     Manawatu District</span></span>
<span><span class="co">#&gt; 5   5     2292771      Unknown        Feilding  Feilding     Manawatu District</span></span>
<span><span class="co">#&gt; 6   6     2292825      Unknown        Feilding  Feilding     Manawatu District</span></span>
<span><span class="co">#&gt;       capture_method capture_source_group capture_source_id</span></span>
<span><span class="co">#&gt; 1 Feature Extraction    NZ Aerial Imagery              1042</span></span>
<span><span class="co">#&gt; 2 Feature Extraction    NZ Aerial Imagery              1042</span></span>
<span><span class="co">#&gt; 3 Feature Extraction    NZ Aerial Imagery              1042</span></span>
<span><span class="co">#&gt; 4 Feature Extraction    NZ Aerial Imagery              1042</span></span>
<span><span class="co">#&gt; 5 Feature Extraction    NZ Aerial Imagery              1042</span></span>
<span><span class="co">#&gt; 6 Feature Extraction    NZ Aerial Imagery              1042</span></span>
<span><span class="co">#&gt;                                       capture_source_name capture_source_from</span></span>
<span><span class="co">#&gt; 1 Manawatu Whanganui 0.3m Rural Aerial Photos (2015-2016)          2015-12-27</span></span>
<span><span class="co">#&gt; 2 Manawatu Whanganui 0.3m Rural Aerial Photos (2015-2016)          2015-12-27</span></span>
<span><span class="co">#&gt; 3 Manawatu Whanganui 0.3m Rural Aerial Photos (2015-2016)          2015-12-27</span></span>
<span><span class="co">#&gt; 4 Manawatu Whanganui 0.3m Rural Aerial Photos (2015-2016)          2015-12-27</span></span>
<span><span class="co">#&gt; 5 Manawatu Whanganui 0.3m Rural Aerial Photos (2015-2016)          2015-12-27</span></span>
<span><span class="co">#&gt; 6 Manawatu Whanganui 0.3m Rural Aerial Photos (2015-2016)          2015-12-27</span></span>
<span><span class="co">#&gt;   capture_source_to last_modified                           geom</span></span>
<span><span class="co">#&gt; 1        2016-04-21    2019-01-04 MULTIPOLYGON (((1796394 556...</span></span>
<span><span class="co">#&gt; 2        2016-04-21    2019-01-04 MULTIPOLYGON (((1776394 557...</span></span>
<span><span class="co">#&gt; 3        2016-04-21    2019-01-04 MULTIPOLYGON (((1776322 557...</span></span>
<span><span class="co">#&gt; 4        2016-04-21    2019-01-04 MULTIPOLYGON (((1818268 554...</span></span>
<span><span class="co">#&gt; 5        2016-04-21    2019-01-04 MULTIPOLYGON (((1818172 554...</span></span>
<span><span class="co">#&gt; 6        2016-04-21    2019-01-04 MULTIPOLYGON (((1818436 554...</span></span>
<span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><sup>Created on 2025-12-13 with <a href="https://reprex.tidyverse.org" class="external-link">reprex v2.1.1</a></sup></p>
</div>
<div class="section level3">
<h3 id="bench_sf_read_sf-r">bench_sf_read_sf.R<a class="anchor" aria-label="anchor" href="#bench_sf_read_sf-r"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.12.2, GDAL 3.10.3, PROJ 9.4.1; sf_use_s2() is TRUE</span></span>
<span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="st">'/home/ctoney/data/gis/nz-building-outlines/nz-building-outlines.gpkg'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="va">f</span>, <span class="st">"nz_building_outlines"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt; 74.969   2.079  77.238</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3289574</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 13 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 1776318 ymin: 5544066 xmax: 1818438 ymax: 5576891</span></span>
<span><span class="co">#&gt; Projected CRS: NZGD2000 / New Zealand Transverse Mercator 2000</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 14</span></span>
<span><span class="co">#&gt;   building_id name  use     suburb_locality town_city territorial_authority</span></span>
<span><span class="co">#&gt;         &lt;int&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;           &lt;chr&gt;     &lt;chr&gt;                </span></span>
<span><span class="co">#&gt; 1     2292051 ""    Unknown Marton          Marton    Rangitikei District  </span></span>
<span><span class="co">#&gt; 2     2292353 ""    Unknown Durie Hill      Whanganui Whanganui District   </span></span>
<span><span class="co">#&gt; 3     2292407 ""    Unknown Durie Hill      Whanganui Whanganui District   </span></span>
<span><span class="co">#&gt; 4     2292675 ""    Unknown Feilding        Feilding  Manawatu District    </span></span>
<span><span class="co">#&gt; 5     2292771 ""    Unknown Feilding        Feilding  Manawatu District    </span></span>
<span><span class="co">#&gt; 6     2292825 ""    Unknown Feilding        Feilding  Manawatu District    </span></span>
<span><span class="co">#&gt; # ℹ 8 more variables: capture_method &lt;chr&gt;, capture_source_group &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   capture_source_id &lt;int&gt;, capture_source_name &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   capture_source_from &lt;date&gt;, capture_source_to &lt;date&gt;, last_modified &lt;date&gt;,</span></span>
<span><span class="co">#&gt; #   geom &lt;MULTIPOLYGON [m]&gt;</span></span></code></pre></div>
<p><sup>Created on 2025-12-13 with <a href="https://reprex.tidyverse.org" class="external-link">reprex v2.1.1</a></sup></p>
</div>
<div class="section level3">
<h3 id="bench_ogr_batch-cpp-rfc86-benchmark">bench_ogr_batch.cpp (<a href="https://gdal.org/en/stable/development/rfc/rfc86_column_oriented_api.html#benchmarks" class="external-link">RFC86
benchmark</a>)<a class="anchor" aria-label="anchor" href="#bench_ogr_batch-cpp-rfc86-benchmark"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co">// https://gdal.org/en/stable/development/rfc/rfc86_column_oriented_api.html#benchmarks</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="pp">#include </span><span class="im">"gdal_priv.h"</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="pp">#include </span><span class="im">"ogr_api.h"</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="pp">#include </span><span class="im">"ogrsf_frmts.h"</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="pp">#include </span><span class="im">"ogr_recordbatch.h"</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">*</span> argv<span class="op">[])</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>    GDALAllRegister<span class="op">();</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>    GDALDataset<span class="op">*</span> poDS <span class="op">=</span> GDALDataset<span class="op">::</span>Open<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>    OGRLayer<span class="op">*</span> poLayer <span class="op">=</span> poDS<span class="op">-&gt;</span>GetLayer<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>    OGRLayerH hLayer <span class="op">=</span> OGRLayer<span class="op">::</span>ToHandle<span class="op">(</span>poLayer<span class="op">);</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>    <span class="kw">struct</span> ArrowArrayStream stream<span class="op">;</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span> <span class="op">!</span>OGR_L_GetArrowStream<span class="op">(</span>hLayer<span class="op">,</span> <span class="op">&amp;</span>stream<span class="op">,</span> <span class="kw">nullptr</span><span class="op">))</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>        CPLError<span class="op">(</span>CE_Failure<span class="op">,</span> CPLE_AppDefined<span class="op">,</span> <span class="st">"OGR_L_GetArrowStream() failed</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>        exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>    <span class="cf">while</span><span class="op">(</span> <span class="kw">true</span> <span class="op">)</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a>        <span class="kw">struct</span> ArrowArray array<span class="op">;</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span> stream<span class="op">.</span>get_next<span class="op">(&amp;</span>stream<span class="op">,</span> <span class="op">&amp;</span>array<span class="op">)</span> <span class="op">!=</span> <span class="dv">0</span> <span class="op">||</span></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a>            array<span class="op">.</span>release <span class="op">==</span> <span class="kw">nullptr</span> <span class="op">)</span></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a>        array<span class="op">.</span>release<span class="op">(&amp;</span>array<span class="op">);</span></span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a>    stream<span class="op">.</span>release<span class="op">(&amp;</span>stream<span class="op">);</span></span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a>    <span class="kw">delete</span> poDS<span class="op">;</span></span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="ex">$</span> g++ bench_ogr_batch.cpp <span class="at">-o</span> bench_ogr_batch <span class="at">-O3</span> <span class="kw">`</span><span class="ex">pkg-config</span> <span class="at">--cflags</span> <span class="at">--libs</span> gdal<span class="kw">`</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="ex">$</span> time ./bench_ogr_batch <span class="st">'/home/ctoney/data/gis/nz-building-outlines/nz-building-outlines.gpkg'</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="ex">real</span>  0m0.448s</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="ex">user</span>  0m1.040s</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="ex">sys</span>   0m0.562s</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bench_gdalraster_arrow_stream-r">bench_gdalraster_arrow_stream.R<a class="anchor" aria-label="anchor" href="#bench_gdalraster_arrow_stream-r"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://firelab.github.io/gdalraster/">gdalraster</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; GDAL 3.10.3 (released 2025-04-01), GEOS 3.12.2, PROJ 9.4.1</span></span>
<span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="st">'/home/ctoney/data/gis/nz-building-outlines/nz-building-outlines.gpkg'</span></span>
<span><span class="op">(</span><span class="va">lyr</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="va">GDALVector</span>, <span class="va">f</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; C++ object of class GDALVector</span></span>
<span><span class="co">#&gt;  Driver : GeoPackage (GPKG)</span></span>
<span><span class="co">#&gt;  DSN    : /home/ctoney/data/gis/nz-building-outlines/nz-building-outlines.gpkg</span></span>
<span><span class="co">#&gt;  Layer  : nz_building_outlines</span></span>
<span><span class="co">#&gt;  CRS    : NZGD2000 / New Zealand Transverse Mercator 2000 (EPSG:2193)</span></span>
<span><span class="co">#&gt;  Geom   : MULTIPOLYGON</span></span>
<span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3289574</span></span>
<span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">testCapability</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">FastGetArrowStream</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>nanoarrow.warn_unregistered_extension <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">stream</span> <span class="op">&lt;-</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">getArrowStream</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;nanoarrow_array_stream struct&lt;fid: int64, building_id: int32, name: string, use: string, suburb_locality: string, town_city: string, territorial_authority: string, capture_method: string, capture_source_group: string, capture_source_id: int32, capture_source_name: string, capture_source_from: date32, capture_source_to: date32, last_modified: date32, geom: ogc.wkb{binary}&gt;&gt;</span></span>
<span><span class="co">#&gt;  $ get_schema:function ()  </span></span>
<span><span class="co">#&gt;  $ get_next  :function (schema = x$get_schema(), validate = TRUE)  </span></span>
<span><span class="co">#&gt;  $ release   :function ()</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">stream</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   3.223   0.856   2.870</span></span>
<span></span>
<span><span class="va">stream</span><span class="op">$</span><span class="fu">release</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">==</span> <span class="va">lyr</span><span class="op">$</span><span class="fu">getFeatureCount</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt;   fid building_id name     use suburb_locality town_city territorial_authority</span></span>
<span><span class="co">#&gt; 1   1     2292051      Unknown          Marton    Marton   Rangitikei District</span></span>
<span><span class="co">#&gt; 2   2     2292353      Unknown      Durie Hill Whanganui    Whanganui District</span></span>
<span><span class="co">#&gt; 3   3     2292407      Unknown      Durie Hill Whanganui    Whanganui District</span></span>
<span><span class="co">#&gt; 4   4     2292675      Unknown        Feilding  Feilding     Manawatu District</span></span>
<span><span class="co">#&gt; 5   5     2292771      Unknown        Feilding  Feilding     Manawatu District</span></span>
<span><span class="co">#&gt; 6   6     2292825      Unknown        Feilding  Feilding     Manawatu District</span></span>
<span><span class="co">#&gt;       capture_method capture_source_group capture_source_id</span></span>
<span><span class="co">#&gt; 1 Feature Extraction    NZ Aerial Imagery              1042</span></span>
<span><span class="co">#&gt; 2 Feature Extraction    NZ Aerial Imagery              1042</span></span>
<span><span class="co">#&gt; 3 Feature Extraction    NZ Aerial Imagery              1042</span></span>
<span><span class="co">#&gt; 4 Feature Extraction    NZ Aerial Imagery              1042</span></span>
<span><span class="co">#&gt; 5 Feature Extraction    NZ Aerial Imagery              1042</span></span>
<span><span class="co">#&gt; 6 Feature Extraction    NZ Aerial Imagery              1042</span></span>
<span><span class="co">#&gt;                                       capture_source_name capture_source_from</span></span>
<span><span class="co">#&gt; 1 Manawatu Whanganui 0.3m Rural Aerial Photos (2015-2016)          2015-12-27</span></span>
<span><span class="co">#&gt; 2 Manawatu Whanganui 0.3m Rural Aerial Photos (2015-2016)          2015-12-27</span></span>
<span><span class="co">#&gt; 3 Manawatu Whanganui 0.3m Rural Aerial Photos (2015-2016)          2015-12-27</span></span>
<span><span class="co">#&gt; 4 Manawatu Whanganui 0.3m Rural Aerial Photos (2015-2016)          2015-12-27</span></span>
<span><span class="co">#&gt; 5 Manawatu Whanganui 0.3m Rural Aerial Photos (2015-2016)          2015-12-27</span></span>
<span><span class="co">#&gt; 6 Manawatu Whanganui 0.3m Rural Aerial Photos (2015-2016)          2015-12-27</span></span>
<span><span class="co">#&gt;   capture_source_to last_modified        geom</span></span>
<span><span class="co">#&gt; 1        2016-04-21    2019-01-04 blob[102 B]</span></span>
<span><span class="co">#&gt; 2        2016-04-21    2019-01-04 blob[102 B]</span></span>
<span><span class="co">#&gt; 3        2016-04-21    2019-01-04 blob[230 B]</span></span>
<span><span class="co">#&gt; 4        2016-04-21    2019-01-04 blob[102 B]</span></span>
<span><span class="co">#&gt; 5        2016-04-21    2019-01-04 blob[118 B]</span></span>
<span><span class="co">#&gt; 6        2016-04-21    2019-01-04 blob[102 B]</span></span>
<span></span>
<span><span class="va">lyr</span><span class="op">$</span><span class="fu">close</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><sup>Created on 2025-12-13 with <a href="https://reprex.tidyverse.org" class="external-link">reprex v2.1.1</a></sup></p>
</div>
<div class="section level3">
<h3 id="bench_sf_read_sf_use_stream-r">bench_sf_read_sf_use_stream.R<a class="anchor" aria-label="anchor" href="#bench_sf_read_sf_use_stream-r"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.12.2, GDAL 3.10.3, PROJ 9.4.1; sf_use_s2() is TRUE</span></span>
<span></span>
<span><span class="va">f</span> <span class="op">&lt;-</span> <span class="st">'/home/ctoney/data/gis/nz-building-outlines/nz-building-outlines.gpkg'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">read_sf</span><span class="op">(</span><span class="va">f</span>, <span class="st">"nz_building_outlines"</span>, use_stream <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;  10.876   1.453  11.168</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3289574</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 13 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 1776318 ymin: 5544066 xmax: 1818438 ymax: 5576891</span></span>
<span><span class="co">#&gt; Projected CRS: NZGD2000 / New Zealand Transverse Mercator 2000</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 14</span></span>
<span><span class="co">#&gt;   building_id name  use     suburb_locality town_city territorial_authority</span></span>
<span><span class="co">#&gt;         &lt;int&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;           &lt;chr&gt;     &lt;chr&gt;                </span></span>
<span><span class="co">#&gt; 1     2292051 ""    Unknown Marton          Marton    Rangitikei District  </span></span>
<span><span class="co">#&gt; 2     2292353 ""    Unknown Durie Hill      Whanganui Whanganui District   </span></span>
<span><span class="co">#&gt; 3     2292407 ""    Unknown Durie Hill      Whanganui Whanganui District   </span></span>
<span><span class="co">#&gt; 4     2292675 ""    Unknown Feilding        Feilding  Manawatu District    </span></span>
<span><span class="co">#&gt; 5     2292771 ""    Unknown Feilding        Feilding  Manawatu District    </span></span>
<span><span class="co">#&gt; 6     2292825 ""    Unknown Feilding        Feilding  Manawatu District    </span></span>
<span><span class="co">#&gt; # ℹ 8 more variables: capture_method &lt;chr&gt;, capture_source_group &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   capture_source_id &lt;int&gt;, capture_source_name &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   capture_source_from &lt;date&gt;, capture_source_to &lt;date&gt;, last_modified &lt;date&gt;,</span></span>
<span><span class="co">#&gt; #   geom &lt;MULTIPOLYGON [m]&gt;</span></span></code></pre></div>
<p><sup>Created on 2025-12-13 with <a href="https://reprex.tidyverse.org" class="external-link">reprex v2.1.1</a></sup></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/ctoney" class="external-link">Chris Toney</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
